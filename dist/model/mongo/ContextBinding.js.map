{"version":3,"sources":["../../../src/ui5/model/mongo/ContextBinding.js"],"names":[],"mappings":"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","file":"ContextBinding.js","sourcesContent":["// Provides an abstraction for list bindings\nsap.ui.define([\n    'sap/ui/model/ContextBinding',\n    'sap/ui/model/ChangeReason'\n  ],\n  function(ContextBinding, ChangeReason) {\n    \"use strict\";\n\n    /**\n     * Constructor for ContextBinding\n     *\n     * @class\n     * The ContextBinding is a specific binding for a setting context for the model\n     *\n     * @param {sap.ui.model.Model} oModel\n     * @param {String} sPath\n     * @param {Object} oContext\n     * @param {Object} [mParameters]\n     * @abstract\n     * @public\n     * @alias meteor-ui5.model.mongo.ContextBinding\n     * @extends sap.ui.model.ContextBinding\n     */\n    var cContextBinding = ContextBinding.extend(\"meteor-ui5.model.mongo.ContextBinding\", /** @lends meteor-ui5.model.mongo.ContextBinding.prototype */ {\n\n      constructor: function(oModel, sPath, oContext, mParameters, oEvents) {\n        // Call super constructor\n        ContextBinding.call(this, oModel, sPath, oContext, mParameters, oEvents);\n\n        // Execute query.  Although, for reasons I don't understand yet, UI5 is\n        // able to get the property values for this context without running a query,\n        // We need to do so so we can observe changes and reactively update the\n        // data in the front end\n        this._runQuery();\n\n        // Don't know what this does but it's needed - copied from ClientModel.js\n        var that = this;\n        oModel.createBindingContext(sPath, oContext, mParameters, function(oContext) {\n          that.bInitial = false;\n          that.oElementContext = oContext;\n        });\n      }\n    });\n\n    cContextBinding.prototype.destroy = function() {\n      // Stop observing changes in any existing query.  Will run forever otherwise.\n      if (this._oQueryHandle) {\n        this._oQueryHandle.stop();\n      }\n    };\n\n    cContextBinding.prototype._runQuery = function() {\n      // Stop observing changes in any existing query.  Will run forever otherwise.\n      if (this._oQueryHandle) {\n        this._oQueryHandle.stop();\n      }\n\n      // Run query\n      const oCursor = this.oModel.runQuery(this.sPath, this.oContext);\n\n      // Create query handle so we can observe changes\n      this._oQueryHandle = oCursor.observeChanges({\n        addedBefore: (id, fields, before) => {\n          this.fireDataReceived();\n          this._fireChange(ChangeReason.add);\n        },\n\n        changed: (id, fields) => {\n          this._fireChange(ChangeReason.change);\n        },\n\n        removed: (id) => {\n          this._fireChange(ChangeReason.remove);\n        }\n      });\n    }\n\n\n    /**\n     * @see sap.ui.model.ContextBinding.prototype.refresh\n     */\n    cContextBinding.prototype.refresh = function(bForceUpdate) {\n      var that = this;\n      //recreate Context: force update\n      this.oModel.createBindingContext(this.sPath, this.oContext, this.mParameters, function(oContext) {\n        if (that.oElementContext === oContext && !bForceUpdate) {\n          that.oModel.checkUpdate(true, oContext);\n        } else {\n          that.oElementContext = oContext;\n          that._fireChange();\n        }\n      }, true);\n    };\n\n    /**\n     * @see sap.ui.model.ContextBinding.prototype.refresh\n     */\n    cContextBinding.prototype.initialize = function() {\n      var that = this;\n      //recreate Context: force update\n      this.oModel.createBindingContext(this.sPath, this.oContext, this.mParameters, function(oContext) {\n        that.oElementContext = oContext;\n        that._fireChange();\n      }, true);\n    };\n\n    /**\n     * @see sap.ui.model.ContextBinding.prototype.setContext\n     */\n    cContextBinding.prototype.setContext = function(oContext) {\n      var that = this;\n      if (this.oContext != oContext) {\n        this.oContext = oContext;\n        this.oModel.createBindingContext(this.sPath, this.oContext, this.mParameters, function(oContext) {\n          that.oElementContext = oContext;\n          that._fireChange();\n        });\n      }\n    };\n\n    return cContextBinding;\n\n  });\n"]}